<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IoT Department Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root {
    --primary: #003366;
    --secondary: #007bff;
    --success: #28a745;
    --warning: #ffc107;
    --danger: #dc3545;
    --light: #f8f9fa;
    --dark: #343a40;
    --gray: #6c757d;
    --light-gray: #e9ecef;
  }
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f6f8;
    color: #333;
    line-height: 1.6;
  }

  /* Login Styles */
  .login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #003366 0%, #007bff 100%);
  }

  .login-form, .register-form {
    background: white;
    padding: 40px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    width: 100%;
    max-width: 400px;
  }

  .login-form h2, .register-form h2 {
    text-align: center;
    color: var(--primary);
    margin-bottom: 30px;
  }

  .login-form .form-group, .register-form .form-group {
    margin-bottom: 20px;
  }

  .login-form .form-label, .register-form .form-label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: var(--dark);
  }

  .login-form a, .register-form a {
    color: var(--secondary);
    text-decoration: none;
  }

  .login-form a:hover, .register-form a:hover {
    text-decoration: underline;
  }

  .dashboard {
    display: flex;
    min-height: 100vh;
  }

  /* Sidebar */
  .sidebar {
    width: 240px;
    background: var(--primary);
    color: white;
    padding: 20px 0;
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    z-index: 100;
    box-shadow: 2px 0 5px rgba(0,0,0,0.1);
  }

  .sidebar h2 {
    text-align: center;
    margin-bottom: 30px;
    font-size: 22px;
    padding: 0 15px;
  }

  .sidebar ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .sidebar li {
    padding: 15px 25px;
    margin: 5px 0;
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .sidebar li:hover {
    background: #00509e;
  }

  .sidebar li.active {
    background: var(--secondary);
  }

  /* Main content */
  main {
    margin-left: 240px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* Top Bar */
  .topbar {
    background: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 30px;
    box-shadow: 0 1px 5px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .search-container {
    display: flex;
    align-items: center;
    background: var(--light-gray);
    border-radius: 20px;
    padding: 5px 15px;
    width: 40%;
    max-width: 400px;
  }

  .search-container i {
    color: var(--gray);
    margin-right: 8px;
  }

  .search-container input {
    background: transparent;
    border: none;
    outline: none;
    width: 100%;
    padding: 8px 0;
  }

  .user-profile {
    display: flex;
    align-items: center;
    gap: 15px;
    position: relative;
    cursor: pointer;
  }

  .user-profile img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
  }

  .dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 5px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    width: 200px;
    display: none;
    z-index: 1000;
  }

  .dropdown.active {
    display: block;
  }

  .dropdown-item {
    padding: 12px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .dropdown-item:hover {
    background: var(--light-gray);
  }

  .dropdown-divider {
    height: 1px;
    background: var(--light-gray);
    margin: 5px 0;
  }

  /* Dashboard container */
  .dashboard-container {
    width: 100%;
    padding: 30px;
    flex-grow: 1;
  }

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }

  .page-title {
    color: var(--primary);
    font-size: 28px;
    font-weight: 600;
  }

  .page-subtitle {
    color: var(--gray);
    font-size: 16px;
    margin-top: 5px;
  }

  .btn-primary {
    background: var(--secondary);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    transition: background 0.3s;
  }

  .btn-primary:hover {
    background: #0056b3;
  }

  /* KPI Cards */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .kpi-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    display: flex;
    align-items: center;
    gap: 15px;
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .kpi-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }

  .kpi-icon {
    width: 60px;
    height: 60px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
  }

  .kpi-icon.devices {
    background: rgba(0, 123, 255, 0.1);
    color: var(--secondary);
  }

  .kpi-icon.online {
    background: rgba(40, 167, 69, 0.1);
    color: var(--success);
  }

  .kpi-icon.offline {
    background: rgba(220, 53, 69, 0.1);
    color: var(--danger);
  }

  .kpi-icon.data {
    background: rgba(255, 193, 7, 0.1);
    color: var(--warning);
  }

  .kpi-info h3 {
    font-size: 14px;
    color: var(--gray);
    margin-bottom: 5px;
  }

  .kpi-info .value {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 5px;
  }

  .kpi-info .trend {
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .trend.up {
    color: var(--success);
  }

  .trend.down {
    color: var(--danger);
  }

  /* Dashboard Grid */
  .dashboard-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
  }

  .dashboard-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .card-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--primary);
  }

  .card-actions {
    display: flex;
    gap: 10px;
  }

  .btn-icon {
    background: none;
    border: none;
    color: var(--gray);
    cursor: pointer;
    font-size: 16px;
    transition: color 0.3s;
  }

  .btn-icon:hover {
    color: var(--secondary);
  }

  /* Network Map */
  .network-map {
    height: 300px;
    background: var(--light-gray);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }

  .network-map::before {
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    background-image: 
      radial-gradient(circle at 20% 30%, var(--secondary) 2px, transparent 2px),
      radial-gradient(circle at 50% 70%, var(--success) 2px, transparent 2px),
      radial-gradient(circle at 80% 40%, var(--danger) 2px, transparent 2px),
      radial-gradient(circle at 30% 60%, var(--warning) 2px, transparent 2px);
    background-size: 100px 100px;
    opacity: 0.3;
  }

  .map-center {
    width: 80px;
    height: 80px;
    background: var(--primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
    z-index: 1;
  }

  /* Alerts List */
  .alert-item {
    display: flex;
    align-items: center;
    padding: 15px;
    border-left: 4px solid var(--danger);
    background: white;
    margin-bottom: 10px;
    border-radius: 0 8px 8px 0;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }

  .alert-item.warning {
    border-left-color: var(--warning);
  }

  .alert-item.info {
    border-left-color: var(--secondary);
  }

  .alert-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    font-size: 18px;
  }

  .alert-item.critical .alert-icon {
    background: rgba(220, 53, 69, 0.1);
    color: var(--danger);
  }

  .alert-item.warning .alert-icon {
    background: rgba(255, 193, 7, 0.1);
    color: var(--warning);
  }

  .alert-item.info .alert-icon {
    background: rgba(0, 123, 255, 0.1);
    color: var(--secondary);
  }

  .alert-content {
    flex-grow: 1;
  }

  .alert-title {
    font-weight: 600;
    margin-bottom: 5px;
  }

  .alert-desc {
    font-size: 14px;
    color: var(--gray);
  }

  .alert-time {
    font-size: 12px;
    color: var(--gray);
    margin-top: 5px;
  }

  .alert-actions {
    display: flex;
    gap: 10px;
  }

  .btn-sm {
    padding: 5px 10px;
    font-size: 12px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    transition: background 0.3s;
  }

  .btn-success {
    background: var(--success);
    color: white;
  }

  .btn-success:hover {
    background: #218838;
  }

  .btn-outline {
    background: transparent;
    border: 1px solid var(--gray);
    color: var(--gray);
  }

  .btn-outline:hover {
    background: var(--light-gray);
  }

  .btn-danger {
    background: var(--danger);
    color: white;
  }

  .btn-danger:hover {
    background: #c82333;
  }

  /* Projects List */
  .project-item {
    padding: 15px;
    background: white;
    margin-bottom: 15px;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }

  .project-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .project-title {
    font-weight: 600;
  }

  .project-deadline {
    font-size: 14px;
    color: var(--gray);
  }

  .project-progress {
    margin-bottom: 10px;
  }

  .progress-bar {
    height: 8px;
    background: var(--light-gray);
    border-radius: 4px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: var(--secondary);
    border-radius: 4px;
    transition: width 0.5s;
  }

  .project-meta {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
    color: var(--gray);
  }

  /* Device Grid */
  .device-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .device-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    transition: transform 0.3s, box-shadow 0.3s;
    position: relative;
  }

  .device-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }

  .device-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }

  .device-name {
    font-weight: 600;
    font-size: 18px;
  }

  .device-status {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
  }

  .status-online {
    color: var(--success);
  }

  .status-offline {
    color: var(--danger);
  }

  .status-indicator {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .status-online .status-indicator {
    background: var(--success);
  }

  .status-offline .status-indicator {
    background: var(--danger);
  }

  .device-data {
    margin-bottom: 15px;
  }

  .data-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 14px;
  }

  .data-label {
    color: var(--gray);
  }

  .data-value {
    font-weight: 600;
  }

  .device-actions {
    display: flex;
    gap: 10px;
  }

  .device-actions .btn-sm {
    flex: 1;
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    align-items: center;
    justify-content: center;
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    background: white;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    max-height: 90vh;
    overflow-y: auto;
  }

  .modal-header {
    padding: 20px;
    border-bottom: 1px solid var(--light-gray);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--primary);
  }

  .modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--gray);
  }

  .modal-body {
    padding: 20px;
  }

  .form-group {
    margin-bottom: 15px;
  }

  .form-label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
  }

  .form-control {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--light-gray);
    border-radius: 5px;
    font-size: 16px;
  }

  .modal-footer {
    padding: 15px 20px;
    border-top: 1px solid var(--light-gray);
    display: flex;
    justify-content: flex-end;
    gap: 10px;
  }

  /* Notifications */
  .notifications {
    position: relative;
    cursor: pointer;
  }

  .notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: var(--danger);
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Toast notifications */
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--success);
    color: white;
    padding: 12px 20px;
    border-radius: 5px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    z-index: 3000;
    display: flex;
    align-items: center;
    gap: 10px;
    transform: translateY(100px);
    opacity: 0;
    transition: transform 0.3s, opacity 0.3s;
  }

  .toast.active {
    transform: translateY(0);
    opacity: 1;
  }

  .toast.error {
    background: var(--danger);
  }

  .toast.warning {
    background: var(--warning);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .dashboard-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .dashboard {
      flex-direction: column;
    }

    .sidebar {
      width: 100%;
      height: auto;
      position: relative;
      flex-direction: row;
      justify-content: space-around;
      padding: 10px 0;
    }

    .sidebar h2 {
      margin-bottom: 0;
    }

    .sidebar ul {
      display: flex;
    }

    .sidebar li {
      padding: 10px 15px;
      margin: 0;
    }

    main {
      margin-left: 0;
    }

    .topbar {
      padding: 10px 15px;
    }

    .search-container {
      width: 60%;
    }

    .dashboard-container {
      padding: 20px;
    }

    .kpi-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 576px) {
    .kpi-grid {
      grid-template-columns: 1fr;
    }
    
    .device-grid {
      grid-template-columns: 1fr;
    }
    
    .sidebar ul {
      flex-wrap: wrap;
    }
  }

  /* Page sections */
  .page-section {
    display: none;
  }

  .page-section.active {
    display: block;
  }

  .text-danger { color: var(--danger); }
  .text-warning { color: var(--warning); }
  .text-primary { color: var(--primary); }
  .text-success { color: var(--success); }
</style>
</head>
<body>
  <!-- Login Section -->
  <div id="loginSection" class="login-container">
    <div class="login-form">
      <h2>IoT Dashboard Login</h2>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password">
      </div>
      <button class="btn-primary" onclick="login()">Login</button>
      <p style="text-align: center; margin-top: 15px;">
        Don't have an account? <a href="#" onclick="showRegister()">Register here</a>
      </p>
    </div>

    <div class="register-form" style="display: none;">
      <h2>Register for IoT Dashboard</h2>
      <div class="form-group">
        <label class="form-label">Full Name</label>
        <input type="text" id="registerName" class="form-control" placeholder="Enter your full name">
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" id="registerEmail" class="form-control" placeholder="Enter your email">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" id="registerPassword" class="form-control" placeholder="Create a password">
      </div>
      <button class="btn-primary" onclick="register()">Register</button>
      <p style="text-align: center; margin-top: 15px;">
        Already have an account? <a href="#" onclick="showLogin()">Login here</a>
      </p>
    </div>
  </div>

  <!-- Dashboard Section -->
  <div class="dashboard" id="dashboardSection" style="display: none;">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2>IoT Dashboard</h2>
      <ul>
        <li class="active" onclick="showSection('dashboard')">
          <i class="fas fa-tachometer-alt"></i> Dashboard
        </li>
        <li onclick="showSection('devices')">
          <i class="fas fa-microchip"></i> My Devices
        </li>
        <li onclick="showSection('alerts')">
          <i class="fas fa-exclamation-triangle"></i> System Alerts
        </li>
        <li onclick="showSection('projects')">
          <i class="fas fa-tasks"></i> Pending Projects
        </li>
        <li onclick="showSection('contact')">
          <i class="fas fa-envelope"></i> Contact Us
        </li>
        <li onclick="showSection('about')">
          <i class="fas fa-info-circle"></i> About Us
        </li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main>
      <!-- Top Bar -->
      <header class="topbar">
        <div class="search-container">
          <i class="fas fa-search"></i>
          <input type="text" id="searchInput" placeholder="Search devices, alerts, projects..." onkeyup="handleSearch()">
        </div>
        <div class="user-profile" onclick="toggleDropdown('profileDropdown')">
          <div class="notifications" onclick="toggleDropdown('notificationDropdown', event)">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="notificationCount">0</span>
          </div>
          <div class="user-info">
            <span id="userName">User</span>
            <img src="https://ui-avatars.com/api/?name=User&background=007bff&color=fff" alt="User Avatar" id="userAvatar">
          </div>
          <div class="dropdown" id="profileDropdown">
            <div class="dropdown-item">
              <i class="fas fa-user"></i> Profile
            </div>
            <div class="dropdown-item">
              <i class="fas fa-cog"></i> Settings
            </div>
            <div class="dropdown-divider"></div>
            <div class="dropdown-item" onclick="logout()">
              <i class="fas fa-sign-out-alt"></i> Logout
            </div>
          </div>
          <div class="dropdown" id="notificationDropdown">
            <div class="dropdown-item">
              <i class="fas fa-bell"></i> No new notifications
            </div>
          </div>
        </div>
      </header>

      <div class="dashboard-container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="page-section active">
          <div class="page-header">
            <div>
              <h1 class="page-title">Dashboard Overview</h1>
              <p class="page-subtitle">Welcome back, <span id="welcomeUser">User</span>. Here's what's happening with your IoT network today.</p>
            </div>
            <button class="btn-primary" onclick="openAddDeviceModal()">
              <i class="fas fa-plus"></i> Add Device
            </button>
          </div>

          <!-- KPI Cards -->
          <div class="kpi-grid">
            <div class="kpi-card">
              <div class="kpi-icon devices">
                <i class="fas fa-microchip"></i>
              </div>
              <div class="kpi-info">
                <h3>Total Devices</h3>
                <div class="value" id="totalDevices">0</div>
                <div class="trend up">
                  <i class="fas fa-arrow-up"></i> <span id="deviceTrend">0</span> this week
                </div>
              </div>
            </div>
            <div class="kpi-card">
              <div class="kpi-icon online">
                <i class="fas fa-check-circle"></i>
              </div>
              <div class="kpi-info">
                <h3>Online Devices</h3>
                <div class="value" id="onlineDevices">0</div>
                <div class="trend up">
                  <i class="fas fa-arrow-up"></i> <span id="uptimePercent">0%</span> uptime
                </div>
              </div>
            </div>
            <div class="kpi-card">
              <div class="kpi-icon offline">
                <i class="fas fa-exclamation-circle"></i>
              </div>
              <div class="kpi-info">
                <h3>Offline Devices</h3>
                <div class="value" id="offlineDevices">0</div>
                <div class="trend down">
                  <i class="fas fa-arrow-up"></i> Needs attention
                </div>
              </div>
            </div>
            <div class="kpi-card">
              <div class="kpi-icon data">
                <i class="fas fa-database"></i>
              </div>
              <div class="kpi-info">
                <h3>Data Processed</h3>
                <div class="value" id="dataProcessed">0 GB</div>
                <div class="trend up">
                  <i class="fas fa-arrow-up"></i> <span id="dataTrend">0%</span> from yesterday
                </div>
              </div>
            </div>
          </div>

          <!-- Dashboard Grid -->
          <div class="dashboard-grid">
            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Network Status Map</h3>
                <div class="card-actions">
                  <button class="btn-icon" onclick="refreshNetworkMap()"><i class="fas fa-sync-alt"></i></button>
                  <button class="btn-icon"><i class="fas fa-expand"></i></button>
                </div>
              </div>
              <div class="network-map">
                <div class="map-center">
                  <i class="fas fa-server"></i>
                </div>
              </div>
              <p>Network health: <span style="color: var(--success); font-weight: 600;" id="networkHealth">Good</span></p>
            </div>

            <div class="dashboard-card">
              <div class="card-header">
                <h3 class="card-title">Recent Alerts</h3>
                <div class="card-actions">
                  <button class="btn-icon" onclick="filterAlerts()"><i class="fas fa-filter"></i></button>
                </div>
              </div>
              <div class="alerts-list" id="alertsList">
                <!-- Alerts will be loaded here -->
              </div>
            </div>
          </div>

          <!-- Pending Projects -->
          <div class="dashboard-card">
            <div class="card-header">
              <h3 class="card-title">Pending Projects</h3>
              <div class="card-actions">
                <button class="btn-icon" onclick="openAddProjectModal()"><i class="fas fa-plus"></i></button>
              </div>
            </div>
            <div class="projects-list" id="projectsList">
              <!-- Projects will be loaded here -->
            </div>
          </div>
        </section>

        <!-- My Devices Section -->
        <section id="devices" class="page-section">
          <div class="page-header">
            <div>
              <h1 class="page-title">My Devices</h1>
              <p class="page-subtitle">Manage and monitor all your connected IoT devices</p>
            </div>
            <button class="btn-primary" onclick="openAddDeviceModal()">
              <i class="fas fa-plus"></i> Add Device
            </button>
          </div>

          <div class="device-grid" id="deviceGrid">
            <!-- Devices will be loaded here -->
          </div>
        </section>

        <!-- System Alerts Section -->
        <section id="alerts" class="page-section">
          <div class="page-header">
            <div>
              <h1 class="page-title">System Alerts</h1>
              <p class="page-subtitle">Monitor and manage all system alerts and notifications</p>
            </div>
            <button class="btn-primary" onclick="markAllAlertsAsRead()">
              <i class="fas fa-check-double"></i> Mark All as Read
            </button>
          </div>

          <div class="dashboard-card">
            <div class="card-header">
              <h3 class="card-title">Active Alerts (<span id="activeAlertsCount">0</span>)</h3>
              <div class="card-actions">
                <button class="btn-icon" onclick="filterAlerts()"><i class="fas fa-filter"></i></button>
              </div>
            </div>
            <div class="alerts-list" id="allAlertsList">
              <!-- All alerts will be loaded here -->
            </div>
          </div>
        </section>

        <!-- Pending Projects Section -->
        <section id="projects" class="page-section">
          <div class="page-header">
            <div>
              <h1 class="page-title">Pending Projects</h1>
              <p class="page-subtitle">Track progress of all ongoing IoT deployment projects</p>
            </div>
            <button class="btn-primary" onclick="openAddProjectModal()">
              <i class="fas fa-plus"></i> New Project
            </button>
          </div>

          <div class="dashboard-card">
            <div class="card-header">
              <h3 class="card-title">Active Projects (<span id="activeProjectsCount">0</span>)</h3>
              <div class="card-actions">
                <button class="btn-icon" onclick="exportProjects()"><i class="fas fa-download"></i></button>
              </div>
            </div>
            <div class="projects-list" id="allProjectsList">
              <!-- All projects will be loaded here -->
            </div>
          </div>
        </section>

        <!-- Contact Us Section -->
        <section id="contact" class="page-section">
          <div class="page-header">
            <div>
              <h1 class="page-title">Contact Us</h1>
              <p class="page-subtitle">Get in touch with our IoT support team</p>
            </div>
          </div>

          <div class="dashboard-card">
            <div class="card-header">
              <h3 class="card-title">Support Channels</h3>
            </div>
            <div style="padding: 20px 0;">
              <p>For technical support or questions about your IoT deployment, please contact us through one of the following channels:</p>
              
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                <div>
                  <h4 style="margin-bottom: 10px; color: var(--primary);"><i class="fas fa-envelope"></i> Email Support</h4>
                  <p>mudzimwapanashe123@gmail.com</p>
                  <p style="font-size: 14px; color: var(--gray);">Response within 24 hours</p>
                </div>
                <div>
                  <h4 style="margin-bottom: 10px; color: var(--primary);"><i class="fas fa-envelope"></i> Alternative Email</h4>
                  <p>mudzimwapanashe506@gmail.com</p>
                  <p style="font-size: 14px; color: var(--gray);">For urgent matters</p>
                </div>
                <div>
                  <h4 style="margin-bottom: 10px; color: var(--primary);"><i class="fas fa-phone"></i> Phone Support</h4>
                  <p>+263 788923630</p>
                  <p style="font-size: 14px; color: var(--gray);">Mon-Fri, 9AM-5PM</p>
                </div>
                <div>
                  <h4 style="margin-bottom: 10px; color: var(--primary);"><i class="fas fa-phone"></i> Alternative Phone</h4>
                  <p>+263 713058383</p>
                  <p style="font-size: 14px; color: var(--gray);">Mon-Fri, 9AM-5PM</p>
                </div>
              </div>

              <div style="margin-top: 30px;">
                <h4 style="margin-bottom: 15px; color: var(--primary);">Send us a message</h4>
                <div class="form-group">
                  <label class="form-label">Your Name</label>
                  <input type="text" class="form-control" id="contactName" required>
                </div>
                <div class="form-group">
                  <label class="form-label">Your Email</label>
                  <input type="email" class="form-control" id="contactEmail" required>
                </div>
                <div class="form-group">
                  <label class="form-label">Subject</label>
                  <input type="text" class="form-control" id="contactSubject" required>
                </div>
                <div class="form-group">
                  <label class="form-label">Message</label>
                  <textarea class="form-control" id="contactMessage" rows="4" required></textarea>
                </div>
                <button class="btn-primary" onclick="sendMessage()">Send Message</button>
              </div>
            </div>
          </div>
        </section>

        <!-- About Us Section -->
        <section id="about" class="page-section">
          <div class="page-header">
            <div>
              <h1 class="page-title">About Us</h1>
              <p class="page-subtitle">Learn about our IoT department and mission</p>
            </div>
          </div>

          <div class="dashboard-card">
            <div class="card-header">
              <h3 class="card-title">IoT Department</h3>
            </div>
            <div style="padding: 20px 0;">
              <p>Our IoT Department is dedicated to implementing and maintaining cutting-edge Internet of Things solutions that drive efficiency, automation, and data-driven decision making across the organization.</p>
              
              <h4 style="margin: 20px 0 10px 0; color: var(--primary);">Our Mission</h4>
              <p>To leverage IoT technology to create smarter, more connected environments that improve operational efficiency, reduce costs, and enhance user experiences.</p>
              
              <h4 style="margin: 20px 0 10px 0; color: var(--primary);">What We Do</h4>
              <ul style="padding-left: 20px; margin-bottom: 20px;">
                <li>Design and deploy IoT sensor networks</li>
                <li>Develop custom IoT dashboards and monitoring tools</li>
                <li>Implement predictive maintenance solutions</li>
                <li>Optimize energy consumption through smart monitoring</li>
                <li>Ensure security and reliability of IoT infrastructure</li>
              </ul>
              
              <h4 style="margin: 20px 0 10px 0; color: var(--primary);">Team</h4>
              <p>Our team consists of 15 IoT specialists, including solution architects, data engineers, security experts, and field technicians.</p>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Add Device Modal -->
  <div class="modal" id="addDeviceModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Add New Device</h3>
        <button class="modal-close" onclick="closeModal('addDeviceModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Device Name</label>
          <input type="text" class="form-control" id="deviceName" placeholder="Enter device name">
        </div>
        <div class="form-group">
          <label class="form-label">Device Type</label>
          <select class="form-control" id="deviceType">
            <option value="">Select device type</option>
            <option value="sensor">Sensor</option>
            <option value="gateway">Gateway</option>
            <option value="controller">Controller</option>
            <option value="actuator">Actuator</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Location</label>
          <input type="text" class="form-control" id="deviceLocation" placeholder="Enter device location">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-control" id="deviceDescription" rows="3" placeholder="Enter device description"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-outline" onclick="closeModal('addDeviceModal')">Cancel</button>
        <button class="btn-primary" onclick="addNewDevice()">Add Device</button>
      </div>
    </div>
  </div>

  <!-- Add Project Modal -->
  <div class="modal" id="addProjectModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Add New Project</h3>
        <button class="modal-close" onclick="closeModal('addProjectModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Project Name</label>
          <input type="text" class="form-control" id="projectName" placeholder="Enter project name">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-control" id="projectDescription" rows="3" placeholder="Enter project description"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Due Date</label>
          <input type="date" class="form-control" id="projectDueDate">
        </div>
        <div class="form-group">
          <label class="form-label">Assigned To</label>
          <select class="form-control" id="projectAssignee">
            <option value="you">You</option>
            <option value="team">Team</option>
            <option value="it-team">IT Team</option>
            <option value="dev-team">Dev Team</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-outline" onclick="closeModal('addProjectModal')">Cancel</button>
        <button class="btn-primary" onclick="addNewProject()">Add Project</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage">Device added successfully!</span>
  </div>

  <script>
  // API Configuration
  const API_BASE_URL = 'http://localhost:3000/api';
  let authToken = localStorage.getItem('authToken');
  let currentUser = null;
  let devices = [];
  let alerts = [];
  let projects = [];

  // Initialize the application
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Frontend loaded, checking auth status...');
    checkAuthStatus();
  });

  // Check if user is already logged in
  async function checkAuthStatus() {
    console.log('Checking auth status...');
    
    // First, test if backend is reachable
    try {
      const testResponse = await fetch(`${API_BASE_URL}/status`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      
      if (!testResponse.ok) {
        throw new Error(`Backend not reachable: ${testResponse.status}`);
      }
      
      const testData = await testResponse.json();
      console.log('Backend test:', testData);
    } catch (error) {
      console.error('Backend connection failed:', error);
      showToast('Cannot connect to server. Using demo mode with local data.', 'warning');
      // Continue with local storage check even if backend is down
    }

    const email = localStorage.getItem("loggedInUser");
    const username = localStorage.getItem("username");
    
    if (email) {
      currentUser = { name: username || email, email: email };
      showDashboard();
    } else {
      showLogin();
    }
  }

  // Authentication Functions
  async function login() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    if (!email || !password) {
      showToast('Please enter both email and password', 'error');
      return;
    }

    try {
      console.log('Attempting login...');
      const response = await fetch(`${API_BASE_URL}/auth/check`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email, password })
      });

      if (response.ok) {
        const data = await response.json();
        console.log('Login successful:', data);
        
        // Store user info in localStorage
        localStorage.setItem('loggedInUser', email);
        localStorage.setItem('username', email.split('@')[0]);
        
        currentUser = { 
          name: email.split('@')[0], 
          email: email 
        };
        
        showDashboard();
        showToast('Login successful!');
      } else {
        // If backend fails, use local authentication as fallback
        console.log('Backend auth failed, using local auth');
        localStorage.setItem('loggedInUser', email);
        localStorage.setItem('username', email.split('@')[0]);
        
        currentUser = { 
          name: email.split('@')[0], 
          email: email 
        };
        
        showDashboard();
        showToast('Login successful! (Local mode)');
      }
    } catch (error) {
      console.error('Login error, using local auth:', error);
      // Fallback to local authentication
      localStorage.setItem('loggedInUser', email);
      localStorage.setItem('username', email.split('@')[0]);
      
      currentUser = { 
        name: email.split('@')[0], 
        email: email 
      };
      
      showDashboard();
      showToast('Login successful! (Offline mode)');
    }
  }

  async function register() {
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;

    if (!name || !email || !password) {
      showToast('Please fill in all fields', 'error');
      return;
    }

    try {
      console.log('Attempting registration...');
      const response = await fetch(`${API_BASE_URL}/auth/check`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email, password })
      });

      if (response.ok) {
        // Store user info
        localStorage.setItem('loggedInUser', email);
        localStorage.setItem('username', name);
        
        showToast('Registration successful! Please login.');
        showLogin();
      } else {
        // Fallback for registration
        localStorage.setItem('loggedInUser', email);
        localStorage.setItem('username', name);
        
        showToast('Registration successful! (Local mode)');
        showLogin();
      }
    } catch (error) {
      console.error('Registration error, using local storage:', error);
      // Fallback to local storage
      localStorage.setItem('loggedInUser', email);
      localStorage.setItem('username', name);
      
      showToast('Registration successful! (Offline mode)');
      showLogin();
    }
  }

  function logout() {
    localStorage.removeItem('loggedInUser');
    localStorage.removeItem('username');
    authToken = null;
    currentUser = null;
    showLogin();
    showToast('Logged out successfully');
  }

  function showLogin() {
    document.getElementById('loginSection').style.display = 'flex';
    document.getElementById('dashboardSection').style.display = 'none';
    document.querySelector('.login-form').style.display = 'block';
    document.querySelector('.register-form').style.display = 'none';
    
    // Clear form fields
    document.getElementById('loginEmail').value = '';
    document.getElementById('loginPassword').value = '';
    document.getElementById('registerName').value = '';
    document.getElementById('registerEmail').value = '';
    document.getElementById('registerPassword').value = '';
  }

  function showRegister() {
    document.querySelector('.login-form').style.display = 'none';
    document.querySelector('.register-form').style.display = 'block';
  }

  function showDashboard() {
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('dashboardSection').style.display = 'flex';
    
    // Update user info
    const username = localStorage.getItem('username') || 'User';
    const email = localStorage.getItem('loggedInUser') || 'user@example.com';
    
    document.getElementById('userName').textContent = username;
    document.getElementById('welcomeUser').textContent = username;
    document.getElementById('userAvatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=007bff&color=fff`;
    
    // Load initial data
    loadDashboardData();
    loadDevices();
    loadAlerts();
    loadProjects();
  }

  // API Helper Functions
  async function apiRequest(endpoint, options = {}) {
    const defaultOptions = {
      headers: {
        'Content-Type': 'application/json'
      }
    };

    const config = { ...defaultOptions, ...options };
    
    try {
      console.log(`Making API request to: ${endpoint}`);
      const response = await fetch(`${API_BASE_URL}${endpoint}`, config);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }

      return await response.json();
    } catch (error) {
      console.error('API request error:', error);
      // Return mock data for demo purposes
      return getMockData(endpoint);
    }
  }

  // Mock data for demo purposes
  function getMockData(endpoint) {
    switch(endpoint) {
      case '/devices/stats/summary':
        return {
          totalDevices: 8,
          onlineDevices: 6,
          offlineDevices: 2
        };
      case '/devices':
        return [
          { _id: '1', name: 'Temperature Sensor 1', type: 'sensor', location: 'Room 101', status: 'online', data: { temperature: '20.0°C', battery: '100%', lastUpdate: 'Just now' } },
          { _id: '2', name: 'Humidity Sensor 1', type: 'sensor', location: 'Room 102', status: 'online', data: { humidity: '45%', battery: '85%', lastUpdate: '2 minutes ago' } },
          { _id: '3', name: 'Motion Sensor 1', type: 'sensor', location: 'Hallway', status: 'offline', data: { motion: 'No', battery: '12%', lastUpdate: '5 hours ago' } },
          { _id: '4', name: 'Smart Light 1', type: 'actuator', location: 'Room 101', status: 'online', data: { state: 'On', brightness: '80%', lastUpdate: 'Just now' } },
          { _id: '5', name: 'Smart Thermostat', type: 'controller', location: 'Lobby', status: 'online', data: { temperature: '22.0°C', setpoint: '21.5°C', lastUpdate: '1 minute ago' } }
        ];
      case '/alerts':
        return [
          { _id: '1', type: 'critical', title: 'Device Offline', description: 'Motion Sensor 1 has been offline for 5 hours', acknowledged: false, createdAt: new Date().toISOString() },
          { _id: '2', type: 'warning', title: 'Low Battery', description: 'Humidity Sensor 1 battery is at 15%', acknowledged: false, createdAt: new Date().toISOString() },
          { _id: '3', type: 'info', title: 'New Device Added', description: 'Smart Light 1 was added to the network', acknowledged: true, createdAt: new Date(Date.now() - 86400000).toISOString() }
        ];
      case '/projects':
        return [
          { _id: '1', title: 'IoT Deployment Phase 1', description: 'Deploy sensors in building A', deadline: '2024-12-31', assignee: 'you', progress: 65 },
          { _id: '2', title: 'Network Infrastructure Upgrade', description: 'Upgrade network switches for better IoT support', deadline: '2024-11-15', assignee: 'team', progress: 20 },
          { _id: '3', title: 'Data Analytics Dashboard', description: 'Develop real-time analytics dashboard for sensor data', deadline: '2024-10-30', assignee: 'dev-team', progress: 80 }
        ];
      default:
        return { success: true, message: 'Operation completed' };
    }
  }

  // Dashboard Data Loading
  async function loadDashboardData() {
    try {
      const stats = await apiRequest('/devices/stats/summary');
      if (stats) {
        document.getElementById('totalDevices').textContent = stats.totalDevices;
        document.getElementById('onlineDevices').textContent = stats.onlineDevices;
        document.getElementById('offlineDevices').textContent = stats.offlineDevices;
        
        // Calculate and display trends
        const uptimePercent = stats.totalDevices > 0 ? 
          Math.round((stats.onlineDevices / stats.totalDevices) * 100) : 0;
        document.getElementById('uptimePercent').textContent = `${uptimePercent}%`;
        
        // Simulate data trends
        document.getElementById('deviceTrend').textContent = Math.floor(Math.random() * 5) + 1;
        document.getElementById('dataTrend').textContent = `${Math.floor(Math.random() * 15) + 5}%`;
        document.getElementById('dataProcessed').textContent = `${(Math.random() * 5 + 2).toFixed(1)} GB`;
      }
    } catch (error) {
      console.error('Failed to load dashboard stats:', error);
    }
  }

  // Device Management
  async function loadDevices() {
    try {
      devices = await apiRequest('/devices') || [];
      renderDevices();
    } catch (error) {
      console.error('Failed to load devices:', error);
    }
  }

  function renderDevices() {
    const deviceGrid = document.getElementById('deviceGrid');
    
    if (!devices || devices.length === 0) {
      deviceGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);">No devices found. Add your first device to get started.</p>';
      return;
    }

    deviceGrid.innerHTML = '';
    
    devices.forEach(device => {
      const deviceCard = document.createElement('div');
      deviceCard.className = 'device-card';
      deviceCard.setAttribute('data-device-id', device._id);
      
      const statusClass = device.status === 'online' ? 'status-online' : 'status-offline';
      const statusText = device.status === 'online' ? 'Online' : 'Offline';
      
      let dataItems = '';
      if (device.data) {
        for (const [key, value] of Object.entries(device.data)) {
          if (value && value !== '--') {
            const formattedKey = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
            const valueClass = key === 'battery' && parseInt(value) < 20 ? 'style="color: var(--warning);"' : 
                              key === 'battery' && parseInt(value) < 10 ? 'style="color: var(--danger);"' : '';
            dataItems += `
              <div class="data-item">
                <span class="data-label">${formattedKey}</span>
                <span class="data-value" ${valueClass}>${value}</span>
              </div>
            `;
          }
        }
      }
      
      // Add default data if no specific data is available
      if (!dataItems) {
        dataItems = `
          <div class="data-item">
            <span class="data-label">Status</span>
            <span class="data-value">${device.status}</span>
          </div>
          <div class="data-item">
            <span class="data-label">Location</span>
            <span class="data-value">${device.location}</span>
          </div>
          <div class="data-item">
            <span class="data-label">Type</span>
            <span class="data-value">${device.type}</span>
          </div>
        `;
      }
      
      deviceCard.innerHTML = `
        <div class="device-header">
          <div class="device-name">${device.name}</div>
          <div class="device-status ${statusClass}">
            <div class="status-indicator"></div>
            <span>${statusText}</span>
          </div>
        </div>
        <div class="device-data">
          ${dataItems}
        </div>
        <div class="device-actions">
          <button class="btn-sm btn-outline" onclick="restartDevice('${device._id}')"><i class="fas fa-sync-alt"></i> Restart</button>
          <button class="btn-sm btn-primary" onclick="configureDevice('${device._id}')"><i class="fas fa-cog"></i> Configure</button>
          <button class="btn-sm btn-danger" onclick="deleteDevice('${device._id}')"><i class="fas fa-trash"></i> Delete</button>
        </div>
      `;
      
      deviceGrid.appendChild(deviceCard);
    });
    
    // Update device counts
    loadDashboardData();
  }

  async function addNewDevice() {
    const name = document.getElementById('deviceName').value;
    const type = document.getElementById('deviceType').value;
    const location = document.getElementById('deviceLocation').value;
    const description = document.getElementById('deviceDescription').value;
    
    if (!name || !type || !location) {
      showToast('Please fill in all required fields', 'error');
      return;
    }
    
    try {
      const newDevice = {
        _id: Date.now().toString(),
        name,
        type,
        location,
        description,
        status: 'online',
        data: {
          temperature: '20.0°C',
          battery: '100%',
          lastUpdate: 'Just now'
        }
      };
      
      // Add to local devices array
      devices.push(newDevice);
      
      showToast(`Device "${name}" added successfully!`);
      closeModal('addDeviceModal');
      
      // Reset form
      document.getElementById('deviceName').value = '';
      document.getElementById('deviceType').value = '';
      document.getElementById('deviceLocation').value = '';
      document.getElementById('deviceDescription').value = '';
      
      // Refresh devices list
      renderDevices();
    } catch (error) {
      console.error('Failed to add device:', error);
      showToast('Failed to add device', 'error');
    }
  }

  async function deleteDevice(deviceId) {
    if (!confirm('Are you sure you want to delete this device?')) {
      return;
    }
    
    try {
      // Remove from local devices array
      devices = devices.filter(device => device._id !== deviceId);
      
      showToast('Device deleted successfully!');
      renderDevices();
    } catch (error) {
      console.error('Failed to delete device:', error);
      showToast('Failed to delete device', 'error');
    }
  }

  async function restartDevice(deviceId) {
    const deviceCard = document.querySelector(`[data-device-id="${deviceId}"]`);
    const restartButton = deviceCard.querySelector('.btn-outline');
    const originalText = restartButton.innerHTML;
    
    restartButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Restarting...';
    restartButton.disabled = true;
    
    try {
      // Simulate restart process
      await new Promise(resolve => setTimeout(resolve, 2000));
      
      // Update device status in local array
      const device = devices.find(d => d._id === deviceId);
      if (device) {
        device.status = 'online';
        device.data.lastUpdate = 'Just now';
      }
      
      showToast('Device restarted successfully!');
      renderDevices();
    } catch (error) {
      console.error('Failed to restart device:', error);
      showToast('Failed to restart device', 'error');
    } finally {
      restartButton.innerHTML = originalText;
      restartButton.disabled = false;
    }
  }

  function configureDevice(deviceId) {
    const device = devices.find(d => d._id === deviceId);
    if (device) {
      showToast(`Opening configuration for "${device.name}"`);
    }
  }

  // Alert Management
  async function loadAlerts() {
    try {
      alerts = await apiRequest('/alerts') || [];
      updateAlertsUI();
    } catch (error) {
      console.error('Failed to load alerts:', error);
    }
  }

  function updateAlertsUI() {
    // Update alerts list in dashboard
    const alertsList = document.getElementById('alertsList');
    if (alertsList) {
      alertsList.innerHTML = '';
      
      const recentAlerts = alerts
        .filter(alert => !alert.acknowledged)
        .slice(0, 3);
      
      if (recentAlerts.length === 0) {
        alertsList.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--gray);">No active alerts</p>';
      } else {
        recentAlerts.forEach(alert => {
          const alertItem = createAlertElement(alert);
          alertsList.appendChild(alertItem);
        });
      }
    }
    
    // Update all alerts list
    const allAlertsList = document.getElementById('allAlertsList');
    if (allAlertsList) {
      allAlertsList.innerHTML = '';
      
      const activeAlerts = alerts.filter(alert => !alert.acknowledged);
      document.getElementById('activeAlertsCount').textContent = activeAlerts.length;
      
      if (activeAlerts.length === 0) {
        allAlertsList.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--gray);">No active alerts</p>';
      } else {
        activeAlerts.forEach(alert => {
          const alertItem = createAlertElement(alert);
          allAlertsList.appendChild(alertItem);
        });
      }
    }
    
    // Update notification count
    const unacknowledgedAlerts = alerts.filter(alert => !alert.acknowledged);
    document.getElementById('notificationCount').textContent = unacknowledgedAlerts.length;
    
    // Update notifications dropdown
    updateNotificationsDropdown(unacknowledgedAlerts.slice(0, 5));
  }

  function createAlertElement(alert) {
    const alertItem = document.createElement('div');
    alertItem.className = `alert-item ${alert.type}`;
    alertItem.innerHTML = `
      <div class="alert-icon">
        <i class="fas fa-${getAlertIcon(alert.type)}"></i>
      </div>
      <div class="alert-content">
        <div class="alert-title">${alert.title}</div>
        <div class="alert-desc">${alert.description}</div>
        <div class="alert-time">${formatDate(alert.createdAt)}</div>
      </div>
      <div class="alert-actions">
        ${!alert.acknowledged ? 
          `<button class="btn-sm btn-success" onclick="acknowledgeAlert('${alert._id}')">Acknowledge</button>` :
          '<span style="color: var(--success); font-size: 12px;">Acknowledged</span>'
        }
      </div>
    `;
    return alertItem;
  }

  async function acknowledgeAlert(alertId) {
    try {
      // Update local alerts array
      const alert = alerts.find(a => a._id === alertId);
      if (alert) {
        alert.acknowledged = true;
      }
      
      showToast('Alert acknowledged');
      updateAlertsUI();
    } catch (error) {
      console.error('Failed to acknowledge alert:', error);
    }
  }

  async function markAllAlertsAsRead() {
    try {
      // Update all alerts in local array
      alerts.forEach(alert => {
        alert.acknowledged = true;
      });
      
      showToast('All alerts marked as read');
      updateAlertsUI();
    } catch (error) {
      console.error('Failed to mark all alerts as read:', error);
    }
  }

  // Project Management
  async function loadProjects() {
    try {
      projects = await apiRequest('/projects') || [];
      updateProjectsUI();
    } catch (error) {
      console.error('Failed to load projects:', error);
    }
  }

  function updateProjectsUI() {
    const projectsList = document.getElementById('projectsList');
    if (projectsList) {
      projectsList.innerHTML = '';
      
      const recentProjects = projects.slice(0, 2);
      
      if (recentProjects.length === 0) {
        projectsList.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--gray);">No projects found</p>';
      } else {
        recentProjects.forEach(project => {
          const projectItem = createProjectElement(project);
          projectsList.appendChild(projectItem);
        });
      }
    }
    
    const allProjectsList = document.getElementById('allProjectsList');
    if (allProjectsList) {
      allProjectsList.innerHTML = '';
      document.getElementById('activeProjectsCount').textContent = projects.length;
      
      if (projects.length === 0) {
        allProjectsList.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--gray);">No projects found</p>';
      } else {
        projects.forEach(project => {
          const projectItem = createProjectElement(project);
          allProjectsList.appendChild(projectItem);
        });
      }
    }
  }

  function createProjectElement(project) {
    const projectItem = document.createElement('div');
    projectItem.className = 'project-item';
    projectItem.innerHTML = `
      <div class="project-header">
        <div class="project-title">${project.title}</div>
        <div class="project-deadline">Due: ${formatDate(project.deadline)}</div>
      </div>
      <div class="project-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${project.progress}%"></div>
        </div>
      </div>
      <div class="project-meta">
        <span>Assigned to: ${formatAssignee(project.assignee)}</span>
        <span>${project.progress}% Complete</span>
      </div>
    `;
    return projectItem;
  }

  async function addNewProject() {
    const name = document.getElementById('projectName').value;
    const description = document.getElementById('projectDescription').value;
    const dueDate = document.getElementById('projectDueDate').value;
    const assignee = document.getElementById('projectAssignee').value;
    
    if (!name || !dueDate) {
      showToast('Please fill in all required fields', 'error');
      return;
    }
    
    try {
      const newProject = {
        _id: Date.now().toString(),
        title: name,
        description,
        deadline: dueDate,
        assignee,
        progress: 0
      };
      
      // Add to local projects array
      projects.push(newProject);
      
      showToast(`Project "${name}" added successfully!`);
      closeModal('addProjectModal');
      
      // Reset form
      document.getElementById('projectName').value = '';
      document.getElementById('projectDescription').value = '';
      document.getElementById('projectDueDate').value = '';
      document.getElementById('projectAssignee').value = 'you';
      
      // Refresh projects list
      updateProjectsUI();
    } catch (error) {
      console.error('Failed to add project:', error);
      showToast('Failed to add project', 'error');
    }
  }

  // Contact Form
  async function sendMessage() {
    const name = document.getElementById('contactName').value;
    const email = document.getElementById('contactEmail').value;
    const subject = document.getElementById('contactSubject').value;
    const message = document.getElementById('contactMessage').value;
    
    if (!name || !email || !subject || !message) {
      showToast('Please fill in all fields', 'error');
      return;
    }
    
    try {
      // Simulate sending message
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      showToast('Message sent successfully! We will get back to you soon.');
      
      // Reset form
      document.getElementById('contactName').value = '';
      document.getElementById('contactEmail').value = '';
      document.getElementById('contactSubject').value = '';
      document.getElementById('contactMessage').value = '';
    } catch (error) {
      showToast('Failed to send message. Please try again later.', 'error');
      console.error('Contact form error:', error);
    }
  }

  // Helper Functions
  function getAlertIcon(type) {
    const icons = {
      critical: 'exclamation-circle',
      warning: 'exclamation-triangle',
      info: 'info-circle'
    };
    return icons[type] || 'info-circle';
  }

  function formatDate(dateString) {
    if (!dateString) return 'No date';
    
    try {
      const date = new Date(dateString);
      const now = new Date();
      const diffTime = Math.abs(now - date);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays === 1) return 'Today';
      if (diffDays === 2) return 'Yesterday';
      if (diffDays <= 7) return `${diffDays - 1} days ago`;
      
      return date.toLocaleDateString();
    } catch (e) {
      return dateString;
    }
  }

  function formatAssignee(assignee) {
    const assigneeMap = {
      'you': 'You',
      'team': 'Team',
      'it-team': 'IT Team',
      'dev-team': 'Dev Team'
    };
    return assigneeMap[assignee] || assignee;
  }

  function updateNotificationsDropdown(alerts) {
    const dropdown = document.getElementById('notificationDropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '';
    
    if (alerts.length === 0) {
      dropdown.innerHTML = '<div class="dropdown-item">No new notifications</div>';
      return;
    }
    
    alerts.forEach(alert => {
      const item = document.createElement('div');
      item.className = 'dropdown-item';
      item.innerHTML = `
        <i class="fas fa-${getAlertIcon(alert.type)} ${getAlertColorClass(alert.type)}"></i>
        ${alert.title}
      `;
      dropdown.appendChild(item);
    });
    
    dropdown.innerHTML += `
      <div class="dropdown-divider"></div>
      <div class="dropdown-item" onclick="showSection('alerts')">
        <i class="fas fa-bell"></i> View all notifications
      </div>
    `;
  }

  function getAlertColorClass(type) {
    const colors = {
      critical: 'text-danger',
      warning: 'text-warning',
      info: 'text-primary'
    };
    return colors[type] || '';
  }

  // UI Functions
  function showSection(sectionId) {
    document.querySelectorAll('.page-section').forEach(section => {
      section.classList.remove('active');
    });
    document.getElementById(sectionId).classList.add('active');
    
    document.querySelectorAll('.sidebar li').forEach(item => {
      item.classList.remove('active');
    });
    
    // Find and activate the clicked nav item
    const navItems = document.querySelectorAll('.sidebar li');
    for (let item of navItems) {
      if (item.textContent.includes(sectionId.charAt(0).toUpperCase() + sectionId.slice(1))) {
        item.classList.add('active');
        break;
      }
    }
  }

  function toggleDropdown(dropdownId, e) {
    if (e) e.stopPropagation();
    
    const dropdown = document.getElementById(dropdownId);
    const isActive = dropdown.classList.contains('active');
    
    // Close all dropdowns
    document.querySelectorAll('.dropdown').forEach(d => {
      d.classList.remove('active');
    });
    
    // Toggle the clicked dropdown
    if (!isActive) {
      dropdown.classList.add('active');
    }
  }

  function openAddDeviceModal() {
    document.getElementById('addDeviceModal').classList.add('active');
  }

  function openAddProjectModal() {
    document.getElementById('addProjectModal').classList.add('active');
  }

  function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
  }

  function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    
    toastMessage.textContent = message;
    toast.className = 'toast';
    
    if (type === 'error') {
      toast.classList.add('error');
    } else if (type === 'warning') {
      toast.classList.add('warning');
    }
    
    toast.classList.add('active');
    
    setTimeout(() => {
      toast.classList.remove('active');
    }, 5000);
  }

  // Close dropdowns when clicking outside
  document.addEventListener('click', function() {
    document.querySelectorAll('.dropdown').forEach(dropdown => {
      dropdown.classList.remove('active');
    });
  });

  // Search functionality
  function handleSearch() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    
    document.querySelectorAll('.device-card').forEach(card => {
      const deviceName = card.querySelector('.device-name').textContent.toLowerCase();
      card.style.display = deviceName.includes(searchTerm) ? 'block' : 'none';
    });
    
    document.querySelectorAll('.alert-item').forEach(alert => {
      const alertTitle = alert.querySelector('.alert-title').textContent.toLowerCase();
      alert.style.display = alertTitle.includes(searchTerm) ? 'flex' : 'none';
    });
    
    document.querySelectorAll('.project-item').forEach(project => {
      const projectTitle = project.querySelector('.project-title').textContent.toLowerCase();
      project.style.display = projectTitle.includes(searchTerm) ? 'block' : 'none';
    });
  }

  function refreshNetworkMap() {
    const map = document.querySelector('.network-map');
    map.style.opacity = '0.7';
    setTimeout(() => {
      map.style.opacity = '1';
      showToast('Network map refreshed!');
    }, 1000);
  }

  function filterAlerts() {
    showToast('Filter options would appear here in a real application');
  }

  function exportProjects() {
    showToast('Projects exported successfully!');
  }

  // Real-time data simulation
  function updateRealTimeData() {
    const dataProcessed = document.querySelector('.kpi-card:nth-child(4) .value');
    if (dataProcessed) {
      const dataChange = (Math.random() * 0.2).toFixed(1);
      const currentData = parseFloat(dataProcessed.textContent);
      const newData = (currentData + parseFloat(dataChange)).toFixed(1);
      dataProcessed.textContent = newData + " GB";
    }
  }

  // Update data every 10 seconds
  setInterval(updateRealTimeData, 10000);
</script>
</body>
</html>